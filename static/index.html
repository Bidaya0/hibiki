<!DOCTYPE html>
<html lang="en">
  <head>
    <meta chartset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Hibiki</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/17.0.2/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/17.0.2/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mobx/5.15.4/mobx.umd.min.js"></script>
    <script src="/dist/hibiki-dev.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body>
    <template hibiki>
      <hibiki-config><script type="application/js-literal">
          {
              "modules": {
                  "app": {
                      "type": "app",
                      "rootPath": "http://localhost:5000"
                  },
                  "app2": {
                      "type": "app",
                      "rootPath": "http://localhost:5000/api/"
                  }
              }
          }
      </script></hibiki-config>
      <hibiki-initialdata><script type="application/json">
          {
              "hello": 22,
              "test": [1,2,3]
          }
      </script></hibiki-initialdata>
      <page>
        <define-handler name="foo">
          log(22);
        </define-handler>
        <define-handler name="error">
          log("top-error", @error);
        </define-handler>
        <section class="hero is-primary">
          <div class="hero-body">
            <div class="container">
              <h1 class="title">Bulma Example</h1>
              <p class="subtitle">First Bulma Example!</p>
            </div>
          </div>
        </section>
        <img src="https://static.dashborg.net/static/logo.png">
        <h-data query="/@fetch:get('http://localhost:5000/api/test-handler', {x:55})" output.bindpath="$.apitest"></h-data>
        <div class="section">
          <div class="content">
            <html-ul>
              <h-foreach bind="$.test">
                <li class="level">
                  <div class="level-left">
                    <h-text bind="." format="[%d]" style="font-weight: bold; color: *$.color"></h-text>
                    <a click.handler="$.modalopen = true;" href="#" class="ml-4">Open Modal</a>
                    <button click.handler="$.test[@index] = $.test[@index]+1;" class="button is-info ml-4">+1</button>
                  </div>
                </li>
              </h-foreach>
            </html-ul>
          </div>
        </div>
        <section class="section" style="margin-bottom: 50px;">
          <define-vars context="@x = 55;"></define-vars>
          <local-btn foo.handler="log(28); bubble->foo();" click.handler="$.output = /@fetch:get('http://localhost:5000/api/test'); log(5); bubble->foo()" y="*55"></local-btn>
          <button class="button is-info block" click.handler="$.output = /@fetch:get('http://localhost:5000/api/test-handler', {x: 22})">Run @fetch /api/test-handler</button>
          
          <button class="button is-warning block" click.handler="$.output = /@app2/test-handler(88, 'hello', x=5, y=10, @method='get', ($.output == 55 ? 'color-blue' : 'color-green')=[1,2,3])">
            Run /@app/api/test-handler
          </button>

          <button class="button is-danger block" click.handler="$.output = call ('/@app/api/test-' + 'handler')({y: 28})">
            Run /@app/api/test-handler
          </button>
          
          <button class="button is-info block" click.handler="$.output = /@fetch:post('http://localhost:5000/api/test-handler2', {name: 'mike'})">Run @fetch /api/test-handler2</button>
          <button class="button is-info block" click.handler="/@fetch:get('http://localhost:5000/api/page2')">Page 2</button>
          <div class="block">
            <pre><h-text bind="$" format="json"></h-text></pre>
          </div>
        </section>
        <div class="modal" class.is-active="*$.modalopen">
          <div click.handler="$.modalopen = false;" class="modal-background"></div>
          <div class="modal-content">
            <div class="box">
              <div class="content">
                hello this is a modal!
              </div>
              <button click.handler="$.modalopen = false;" class="button is-info">Close</button>
            </div>
          </div>
          <button click.handler="$.modalopen = false;" class="modal-close is-large" aria-label="close"></button>
        </div>
        <h-inlinedata output.bindpath="$.foo">
          [8, 22, 1, 32]
        </h-inlinedata>
        <h-datasorter bind="$.foo" output.bindpath="$.foo_sorted"></h-datasorter>
        <section class="section">
          <h-dyn bind="'<h1 class=title>dyn-hello</h1>'"></h-dyn>
          <div class="block"><h-dateformat bind="1636423085938" format="hh:mm a"></h-dateformat></div>
          <div class="block"><h-dateformat bind="1636423085938" relative></h-dateformat></div>
          <div class="block"><h-dateformat bind="2502" duration format="mm:ss.SSS"></h-dateformat></div>
        </section>
        <section class="section" style="margin-bottom: 50px;">
          <h-foreach bind="$.foo_sorted">
            <h-withcontext context="@x = $local+100">
              <define-vars context="@y = @x+2000"></define-vars>
              <p><h-text bind="@y"></h-text></p>
            </h-withcontext>
          </h-foreach>
        </section>
        
      </page>

      <define-component name="btn" click.handler="log('in-define-component'); fire->click" args="y" error.handler="log('ehandler2'); throw('last');">
        <button class="button is-info block" click.handler="throw('moo'); fire->click()" error.handler="log('ehandler1'); throw('boo');">Run @fetch /api/test</button>
      </define-component>
      
      <define-component name="card">
        <div class="card column">
          <div class="card-image">
            <figure class="image is-4by3">
              <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">
            </figure>
          </div>
          <div class="card-content">
            <div class="media">
              <div class="media-left">
                <figure class="image is-48x48">
                  <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                </figure>
              </div>
              <div class="media-content">
                <p class="title is-4"><h-text bind="$.name || 'John Smith - x'"></h-text></p>
                <p class="subtitle is-6">@johnsmith</p>
              </div>
            </div>
            
            <div class="content">
              Lorem ipsum dolor sit amet, consectetur adipiscing elit.
              Phasellus nec iaculis mauris. <a>@bulmaio</a>.
              <a href="#">#css</a> <a href="#">#responsive</a>
              <br>
              <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>
            </div>
          </div>
        </div>
      </define-component>
    </template>
  </body>
</html>
