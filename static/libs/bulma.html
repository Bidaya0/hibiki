<define-library name="@hibiki/bulma" hibikiversion="v0.2.1">
  <define-component name="button">
    <div class="control" unwrap="!$args.control" automerge="control">
      <button component="*$args.buttoncomponent" class="button" automerge click.handler="fire->click()">
        <span if="$args.icon" class="icon" automerge="icon"><i class="*$args.icon"></i></span>
        <h-fragment if="!!$args.icon && @children.size">
          <span><h-children bind="@children"></h-children></span>
        </h-fragment>
        <h-fragment if="!$args.icon">
          <h-children bind="@children"></h-children>
        </h-fragment>
      </button>
    </div>
  </define-component>

  <define-component name="box">
    <div class="box" automerge>
      <h-children bind="@children"></h-children>
    </div>
  </define-component>

  <define-component name="block">
    <div class="block" automerge>
      <h-children bind="@children"></h-children>
    </div>
  </define-component>

  <define-component name="content">
    <div class="content" automerge>
      <h-children bind="@children"></h-children>
    </div>
  </define-component>

  <define-component name="icon">
    <span class="icon" automerge><i class="*$args.icon"></i></span>
  </define-component>

  <define-component name="image">
    <figure class="image" automerge="@all|-src">
      <img src="*$args.src">
    </figure>
  </define-component>

  <define-component name="ratio">
    <figure class="image" automerge>
      <h-children inject:class.has-ratio bind="@children"></h-children>
    </figure>
  </define-component>

  <define-component name="notification" defaults="show = true;">
    <define-vars>
      @show = raw($args.show) ?? ref($c.show);
    </define-vars>
    <div if="@show" class="notification" automerge>
      <button if="$args.hasdelete" click.handler="@show = false; fire->delete()" class="delete"></button>
      <h-children bind="@children"></h-children>
    </div>
  </define-component>

  <define-component name="delete">
    <button class="delete" automerge click.handler="fire->click()"><h-children bind="@children"></h-children></button>
  </define-component>

  <define-component name="progress">
    <progress class="progress" automerge><h-children bind="@children"></h-children></progress>
  </define-component>

  <define-component name="tag">
    <span component="*$args.tagcomponent" class="tag" automerge click.handler="fire->click()">
      <h-children bind="@children"></h-children>
    </span>
  </define-component>

  <define-component name="tags">
    <div class="control" unwrap="!$args.control" automerge="control">
      <div class="tags has-addons" automerge="@all|-control|-hasdelete">
        <h-children bind="@children"></h-children>
        <local-tag if="$args.hasdelete" tagcomponent="a" class="is-delete" automerge="delete" click.handler="fire->delete()"></local-tag>
      </div>
    </div>
  </define-component>

  <define-component name="title">
    <div component="*$args.titlecomponent" class="title" automerge="@all|-titlecomponent"><h-children bind="@children"></h-children></div>
  </define-component>

  <define-component name="breadcrumb">
    <nav class="breadcrumb" automerge>
      <ul>
        <li component="h-children" bind="@children.bycomp['@hibiki/bulma:crumb']"></li>
      </ul>
    </nav>
  </define-component>

  <define-component name="crumb">
    <div component="li" class.is-active="*$args.active">
      <a automerge="@all|-active" click.handler="fire->click()"><h-children bind="@children"></h-children></a>
    </div>
  </define-component>

  <!-- inside of a modal, bulma uses different class names for cards -->
  <define-component name="card">
    <div class="* (@modal ? 'modal-card' : 'card')" automerge>
      <div class="* (@modal ? 'modal-card-head' : 'card-header')" if="@children.byslot['header'].size || $args.title" automerge="header">
        <p if="$args.title" class="* (@modal ? 'modal-card-title' : 'card-header-title')">
          {{ $args.title }}
        </p>
        <h-children bind="@children.byslot['header']"></h-children>
        <button if="$args.hasclose" class="delete" click.handler="fire->close()"></button>
      </div>
      <div class="card-image" if="@children.byslot['image'].size" automerge="image">
        <h-children bind="@children.byslot['image']"></h-children>
      </div>
      <div class="* (@modal ? 'modal-card-body' : 'card-content')" if="@children.noslot.size" automerge="content">
        <h-children bind="@children.noslot"></h-children>
      </div>
      <div class="* (@modal ? 'modal-card-foot' : 'card-footer')" if="@children.byslot['footer'].size || @children.byslot['footer-item'].size" automerge="footer">
        <h-children bind="@children.byslot['footer']"></h-children>
        <h-fragment foreach="@elem in @children.byslot['footer-item'].byindex">
          <h-children inject:class="card-footer-item" bind="@elem"></h-children>
        </h-fragment>
      </div>
    </div>
  </define-component>

  <define-component name="dropdown">
    <define-vars>
      @active = raw($args.active) ?? ref($c.active);
      @curvalue = raw($args.value) ?? ref($c.curvalue);
      @activechildren = invoke(@children.bycomp["@hibiki/bulma:option"].filter, lambda(@node.attrs.value == @curvalue));
    </define-vars>
    <div class="dropdown" automerge class.is-active="* @active" active="*@active" hibiki-mark>
      <div class="dropdown-trigger">
        <button class="button" aria-haspopup="true" aria-controls="dropdown-menu" click.handler="log('menu-click'); @active = !@active">
          <h-if condition="@activechildren.size">
            <h-children bind="@activechildren.first" datacontext="@label=true"></h-children>
          </h-if>
          <h-if condition="!@activechildren.size">
            <span if="$args.label">{{ $args.label }}</span>
            <h-children bind="@children.byslot['label']"></h-children>
          </h-if>
          <span if="!$args.noicon" class="icon is-small">
            <i class="* $args.icon ?? 'fa fa-angle-down'" aria-hidden="true"></i>
          </span>
        </button>
      </div>
      <div class="dropdown-menu">
        <div class="dropdown-content">
          <h-children bind="@children.noslot" inject:click.handler="@active = false; @curvalue = @node.attrs.value;" datacontext="@dropdown=true;"></h-children>
        </div>
      </div>
    </div>
  </define-component>

  <define-component name="option">
    <a if="@dropdown" href="#" class="dropdown-item" click.handler="fire->click()">
      <h-children bind="@children"></h-children>
    </a>
    <span if="@label">
      <h-children bind="@children"></h-children>
    </span>
  </define-component>

  <define-component name="menu">
    
  </define-component>

  <define-component name="message" defaults="show=true;">
    <define-vars>
      @show = raw($args.show) ?? ref($c.show);
    </define-vars>
    <div if="@show" class="message" automerge>
      <div hibiki-mark class="message-header" if="@children.byslot.header.size || $args.title" automerge="header">
        <h-children text="*$args.title" bind="@children.byslot['header']"></h-children>
        <button if="$args.hasdelete" click.handler="@show = false; fire->delete()" class="delete"></button>
      </div>
      <div class="message-body" automerge="body">
        <h-children bind="@children.noslot"></h-children>
      </div>
    </div>
  </define-component>

  <define-component name="modal" defaults="show=true;">
    <define-vars>
      @show = raw($args.show) ?? ref($c.show);
      @cardchildren = @children.bycomp['@hibiki/bulma:card'];
    </define-vars>
    <div class="modal" class.is-active="*@show">
      <div class="modal-background"></div>
      <div if="!@cardchildren.size" class="modal-content" automerge="content">
        <h-children bind="@children.noslot"></h-children>
      </div>
      <h-children if="@cardchildren.size" bind="@cardchildren.first" inject:close.handler="@show = false; fire->close();" datacontext="@modal = true;"></h-children>
      <button if="!$args.noclose" click.handler="@show = false; fire->close();" class="modal-close is-large"></button>
    </div>
  </define-component>

  <define-component name="modalbutton" defaults="show=false;">
    <define-vars>
      @show = raw($args.show) ?? ref($c.show);
    </define-vars>
    <local-modal show="*@show">
      <h-children bind="@children.noslot"></h-children>
    </local-modal>
    <button if="!$.show_modal" class="button" automerge="button" click.handler="@show = true;">
      <h-children text="*$args.label" bind="@children.byslot['label']"></h-children>
    </button>
  </define-component>

</define-library>
